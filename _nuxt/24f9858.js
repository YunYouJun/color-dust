(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{357:function(t,e,o){var content=o(369);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(12).default)("1fd4a7e6",content,!0,{sourceMap:!1})},360:function(t,e,o){"use strict";o.d(e,"a",(function(){return d}));o(64);var r=o(22),n=(o(4),o(27)),c=o(40),l=o(73);function h(t){var e=t.toHsl();return e.l>.97||e.l>.95&&e.s<.3}function f(t){var e=t.toHsl();return e.l<.03||e.l<.05&&e.s<.3}function v(t){var e=t.toHsl();return 1e4*Math.floor(e.h/10)+100*Math.floor(100*e.s/5)+Math.floor(100*e.l/5)}var d=function(){function t(canvas){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;Object(n.a)(this,t),this.canvas=canvas,this.K=e,this.ctx=this.canvas.getContext("2d"),this.pixelRatio=window.devicePixelRatio||1,this.canvas.width=this.pixelRatio*parseInt(getComputedStyle(this.canvas).width),this.canvas.height=this.pixelRatio*parseInt(getComputedStyle(this.canvas).height),this.oriWidth=this.canvas.width,this.oriHeight=this.canvas.height,this.colorsInfo=[],this.processInfo={numberOfColors:0,censusTime:0,kmeansIteration:0,kmeansTime:0,top5Count:0,pixelCount:0},this.mainColor=[],this.averageColor=new l.a,this.iteration=0,this.score="",this.isHorizontal=!0,this.initSeed=[],this.clusterColors=[],this.info={total:0,top50Count:0,top20Count:0,top10Count:0,top5Count:0}}return Object(c.a)(t,[{key:"readFile",value:function(t){var e=this;if(t instanceof File){var o=new FileReader;return o.readAsDataURL(t),new Promise((function(t){o.onload=function(){var o=Object(r.a)(regeneratorRuntime.mark((function o(r){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!r.target){o.next=4;break}return o.next=3,e.drawToCanvas(r.target.result);case 3:e.censusImage();case 4:t();case 5:case"end":return o.stop()}}),o)})));return function(t){return o.apply(this,arguments)}}()}))}var n=new XMLHttpRequest;return new Promise((function(o){n.onload=function(){var n=Object(r.a)(regeneratorRuntime.mark((function r(n){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!n.target){r.next=5;break}return t=URL.createObjectURL(n.target.response),r.next=4,e.drawToCanvas(t);case 4:e.censusImage();case 5:o();case 6:case"end":return r.stop()}}),r)})));return function(t){return n.apply(this,arguments)}}(),n.open("GET",t,!0),n.responseType="blob",n.send()}))}},{key:"drawToCanvas",value:function(t){var e=this,o=this.pixelRatio,canvas=this.canvas,r=this.ctx;if(r){var img=new Image;return img.src=t,img.crossOrigin="anonymous",new Promise((function(t){img.onload=function(){r.clearRect(0,0,canvas.width,canvas.height);var n=0,c=0;img.width<img.height?(n=100*o,e.isHorizontal=!1):(c=100*o,e.isHorizontal=!0);var l=img.width>(canvas.width-n)/o?(canvas.width-n)/o:img.width,h=img.height>(canvas.height-c)/o?(canvas.height-c)/o:img.height,f=l/img.width<h/img.height?l/img.width:h/img.height;l=img.width*f,h=img.height*f,canvas.style.width=l+n/o+"px",canvas.style.height=h+c/o+"px",canvas.width=l*o+n,canvas.height=h*o+c,r.drawImage(img,0,0,img.width,img.height,0,0,l*o,h*o),t()}}))}}},{key:"censusImage",value:function(){var canvas=this.canvas,t=this.ctx;if(t){var e=this.pixelRatio,o=(new Date).getTime(),r=null;if(!(r=this.isHorizontal?t.getImageData(0,0,canvas.width,canvas.height-100*e):t.getImageData(0,0,canvas.width-100*e,canvas.height)))return"Can not read image data, maybe because of cross-domain limitation.";var n=r.height*r.width<36e4?1:2,c=Math.round(.1066*this.K*this.K-2.7463*this.K+17.2795);c=c<4?4:c;for(var d=[],m=this.processInfo,w=[],C=1;C<r.height-1;C+=n)for(var col=1;col<r.width-1;col+=n){var y=r.data[C*r.width*4+4*col],g=r.data[C*r.width*4+4*col+1],b=r.data[C*r.width*4+4*col+2],k=new l.a({r:y,g:g,b:b});if(!h(k)&&!f(k)){m.pixelCount++;var x=v(k),R=w.indexOf(x);R<0?(w.push(x),d.push({key:x,color:k,count:1,category:-1})):d[R].count++}}m.colorStep=c,m.censusTime=(new Date).getTime()-o,m.numberOfColors=d.length,o=(new Date).getTime(),d.sort((function(pre,t){return t.count-pre.count})),d=d.filter((function(t){return!(t.count<5-n&&d.length>400)})),this.mainColor=[d[0].color,d[1].color,d[2].color];var H=this.chooseSeedColors(d,this.K);this.initSeed=H,this.clusterColors=this.kMC(d,H,100);var M=0,I=0,D=0,T=0;d.forEach((function(t){var e=t.color.toRgb();M+=e.r*t.count,I+=e.g*t.count,D+=e.b*t.count,T+=t.count})),this.averageColor=new l.a({r:Math.floor(M/T),g:Math.floor(I/T),b:Math.floor(D/T)}),m.kmeansTime=+new Date-o,m.kmeansIteration=this.iteration,this.info=this.countColor(d),m.top5Count=100*this.info.top5Count,this.processInfo=m,this.colorsInfo=d}}},{key:"chooseSeedColors",value:function(t,e){for(var o=[],r=t.length,i=0;i<r;i++){var n=o.length,c=t[i];if(0===i)c.category=0,o.push(c);else{for(var l=0;l<n;l++){var h=o[l].color.toHsl(),f=c.color.toHsl();if(Math.abs(h.h-f.h)+100*Math.abs(h.s-f.s)+100*Math.abs(h.l-f.l)<45)break}if(l===n&&(c.category=o.length,o.push(c)),o.length>=e)break}}return o}},{key:"kMC",value:function(t,e,o){var r=this;this.iteration=0;for(var n=function(){e=e.filter((function(t){return t}));for(var o=t.length,n=o/8^0,c=o%8;c--;)r.classifyColor(t[c],e);for(;n--;)r.classifyColor(t[--o],e),r.classifyColor(t[--o],e),r.classifyColor(t[--o],e),r.classifyColor(t[--o],e),r.classifyColor(t[--o],e),r.classifyColor(t[--o],e),r.classifyColor(t[--o],e),r.classifyColor(t[--o],e);o=t.length;for(var h=[],f=void 0;o--;)f=t[o].category,h[f]?h[f].count+=t[o].count:h[f]={color:new l.a({h:0,s:0,l:0}),count:t[o].count};o=t.length,t.forEach((function(t){f=t.category;var e=h[f].color.toHsl(),o=t.color.toHsl(),r=e.h+o.h*t.count/h[f].count,n=e.s+o.s*t.count/h[f].count,c=e.l+o.l*t.count/h[f].count;h[f].color=new l.a({h:r,s:n,l:c})}));var v=h.every((function(t,o){var r=t.color.toHsl(),n=e[o].color.toHsl();return Math.abs(r.h-n.h)<.5&&Math.abs(r.s-n.s)<.005&&Math.abs(r.l-n.l)<.005}));if(e=h.map((function(t,e){return{color:t.color,category:e,count:t.count}})),v)return"break"};this.iteration++<o;){if("break"===n())break}return e.sort((function(pre,t){var e=pre.color.toRgb(),o=e.r+e.g+e.b,r=t.color.toRgb();return r.r+r.g+r.b-o})),e}},{key:"classifyColor",value:function(t,e){for(var o=e.length,r=1e4,n=-1;o--;){var c=t.color.toHsl(),l=e[o].color.toHsl(),h=Math.abs(l.h-c.h)+100*Math.abs(l.s-c.s)+100*Math.abs(l.l-c.l);h<r&&(r=h,n=o)}t.category=n}},{key:"countColor",value:function(t){for(var e,o=this.info,r=0,n=0,c=0,l=0,h=0,f=t.length;f--;)r+=(e=t[f]).count,f<50&&(n+=e.count,f<20&&(c+=e.count,f<10&&(l+=e.count,f<5&&(h+=e.count))));return f=t.length,o.total=r,o.top50Count=n/r,o.top20Count=c/r,o.top10Count=l/r,o.top5Count=h/r,o}},{key:"drawPalette",value:function(){var t=this.pixelRatio,canvas=this.canvas,e=this.ctx;if(e){var o=this.isHorizontal?canvas.width:canvas.height,r=o*(this.K<10?.02:.01),p=(o-(this.K-1)*r)/this.K;if(0!==this.clusterColors.length){this.isHorizontal?e.clearRect(0,canvas.height-90*t,canvas.width,90*t):e.clearRect(canvas.width-90*t,0,90*t,canvas.height);for(var i=0;i<this.K;i++)e.fillStyle=this.clusterColors[i].color.toHexString(),this.isHorizontal?e.fillRect((p+r)*i,canvas.height-90*t,p,90*t):e.fillRect(canvas.width-90*t,(p+r)*i,90*t,p)}}}},{key:"clearCanvas",value:function(){this.canvas.width=this.oriWidth,this.canvas.height=this.oriHeight}}]),t}()},368:function(t,e,o){"use strict";o(357)},369:function(t,e,o){(e=o(11)(!1)).push([t.i,".album-canvas{position:fixed;opacity:0;z-index:-1;width:300;height:300}",""]),t.exports=e},533:function(t,e,o){"use strict";o.r(e);o(64);var r=o(22),n=o(360),c={head:function(){return{title:this.$t("links.album")}},mounted:function(){this.colorDust=new n.a(this.$refs.albumDemo)},methods:{handleCardClick:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function o(){var img,r,n,c,l;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(img=t.target.previousElementSibling.style.backgroundImage){o.next=3;break}return o.abrupt("return");case 3:return r=img.slice(5,-2),o.next=6,e.colorDust.readFile(r);case 6:n=e.colorDust.mainColor,c=e.colorDust.averageColor,l=n[0],e.$vuetify.theme.dark=l.isDark(),e.$store.commit("theme/setPrimaryColor",c),e.$store.commit("theme/setAccentColor",l);case 12:case"end":return o.stop()}}),o)})))()}}},l=(o(368),o(46)),h=o(54),f=o.n(h),v=o(670),d=o(138),m=o(658),w=o(120),C=o(137),y=o(659),component=Object(l.a)(c,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-row",[o("v-col",{attrs:{cols:"12"}},[o("v-row",[t._l(8,(function(e){return o("v-col",{key:e,attrs:{cols:"6",md:"3"}},[o("v-card",{staticClass:"d-flex",on:{click:t.handleCardClick}},[o("v-img",{staticClass:"grey lighten-2",attrs:{src:"https://picsum.photos/id/"+e+"00/200/200.jpg","aspect-ratio":"1"},scopedSlots:t._u([{key:"placeholder",fn:function(){return[o("v-row",{staticClass:"fill-height ma-0",attrs:{align:"center",justify:"center"}},[o("v-progress-circular",{attrs:{indeterminate:"",color:"grey lighten-5"}})],1)]},proxy:!0}],null,!0)})],1)],1)})),t._v(" "),o("v-col",{attrs:{cols:"12"}},[o("v-alert",{attrs:{border:"left","colored-border":"",elevation:"2"}},[o("p",{staticClass:"ml-2 my-0 headline font-weight-light"},[t._v("\n            "+t._s(t.$t("album.tooltip"))+"\n          ")]),t._v(" "),o("canvas",{ref:"albumDemo",staticClass:"album-canvas"})])],1)],2)],1)],1)}),[],!1,null,null,null);e.default=component.exports;f()(component,{VAlert:v.a,VCard:d.a,VCol:m.a,VImg:w.a,VProgressCircular:C.a,VRow:y.a})}}]);